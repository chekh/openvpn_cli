# OpenVPN CLI Tool

Утилита для управления конфигурациями OpenVPN с автоматическим версионированием сертификатов и адресами.

## Основные возможности

- Автоматическое управление сертификатами с версионированием
- Управление списком доменов и IP-адресов
- Автоматическое разрешение доменных имен в IP-адреса
- Генерация конфигураций OpenVPN с маршрутизацией
- Сохранение истории всех версий конфигураций
- Удобный CLI интерфейс

## Установка

```bash
pip install opnvpn_cli
```

## Настройка

1. Создайте файл `.env` в корневой директории проекта с настройками:
```env
LOG_FILE_PATH=app.log
LOG_LEVEL=INFO
CONFIGS_DIR=configs
```

2. Настройте структуру конфигураций:
```bash
python -m opnvpn_cli setup_configs /путь/к/исходному/конфигу /путь/к/директории/конфигов
```

## Основные команды

### Управление адресами

```bash
# Добавить новый адрес
opnvpn add example.com --name "Example Domain"

# Добавить IP-адрес
opnvpn add 192.168.1.1

# Просмотр списка адресов
opnvpn list
```

### Генерация конфигов

```bash
# Сгенерировать конфиг с конкретной версией сертификатов
opnvpn generate --version "20250619_1"

# Сгенерировать конфиг с последней версией сертификатов
opnvpn generate

# Все сгенерированные конфиги сохраняются с уникальными именами в формате custom_версия.ovpn
```

### Управление сертификатами

```bash
# Просмотр всех версий сертификатов
opnvpn cert-list

# Восстановить конкретную версию сертификатов
opnvpn cert-restore "20250619_1"
```

## Структура файлов

```
configs/
├── addresses.yaml       # База адресов
├── base/                # Базовые конфиги
│   └── base_config.ovpn # Базовый конфиг OpenVPN
├── certs/               # Версии сертификатов
│   └── версия/         # Каждая версия содержит:
│       ├── ca.pem      # Сертификат CA
│       ├── cert.pem    # Клиентский сертификат
│       ├── key.pem     # Приватный ключ
│       ├── tls-auth.pem # TLS-авторизация
│       └── metadata.yaml # Метаданные версии
└── new_configs/         # Сгенерированные конфиги
    └── custom_версия.ovpn # Каждый конфиг с уникальным именем
```

## Формат адресов в базе

```yaml
addresses:
  - name: "Имя адреса"
    address: "домен или IP"
    type: "domain" | "ip"
    resolved_ips: [список IP]
    added_at: "дата добавления"
```

## Логирование

Все операции логируются в файл, указанный в переменной `LOG_FILE_PATH` (по умолчанию `app.log`).

## Пример использования

```bash
# 1. Настроить структуру конфигов
python -m opnvpn_cli setup_configs configs/base/base_config.ovpn configs

# 2. Добавить адрес
opnvpn add google.com --name "Google General"

# 3. Просмотреть список адресов
opnvpn list

# 4. Сгенерировать конфиг
opnvpn generate

# 5. Просмотреть версии сертификатов
opnvpn cert-list
```

## Технические особенности

- Автоматическое разрешение доменных имен в IP-адреса
- Версионирование сертификатов
- Автоматическое включение сертификатов в конфиг
- Ротация логов
- Хранение конфигураций в YAML-формате
- Каждый сгенерированный конфиг сохраняется с уникальным именем
- Поддержка Python 3.11 и выше